<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge;chrome=1" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>测试站点</title>
<script type="text/javascript" th:src="@{/data/resource/js/jquery.js}"></script>
<script type="text/javascript" th:src="@{/data/resource/js/jquery.validation.min.js}"></script>
<script type="text/javascript" th:src="@{/data/resource/js/admincp.js}"></script>
<script type="text/javascript" th:src="@{/data/resource/js/jquery.cookie.js}"></script>
<script type="text/javascript" th:src="@{/data/resource/js/common.js}" charset="utf-8"></script>
<link th:href="@{/admin/templates/default/css/skin_1.css}" rel="stylesheet" type="text/css" id="cssfile2" />
<link th:href="@{/data/resource/js/perfect-scrollbar.min.css}" rel="stylesheet" type="text/css" />
<link th:href="@{/admin/templates/default/css/font/font-awesome/css/font-awesome.min.css}" rel="stylesheet" />
<!--[if IE 7]>
  <link rel="stylesheet" href="http://localhost:8090/shopnc/admin/templates/default/css/font/font-awesome/css/font-awesome-ie7.min.css">
<![endif]-->
<script type="text/javascript" th:src="@{/data/resource/js/perfect-scrollbar.min.js}"></script>

<script type="text/javascript">
SITEURL = 'http://localhost:8090/shopnc/shop';
RESOURCE_SITE_URL = 'http://localhost:8090/shopnc/data/resource';
MICROSHOP_SITE_URL = 'http://localhost:8090/shopnc/microshop';
CIRCLE_SITE_URL = 'http://localhost:8090/shopnc/circle';
ADMIN_TEMPLATES_URL = 'http://localhost:8090/shopnc/admin/templates/default';
LOADING_IMAGE = "http://localhost:8090/shopnc/admin/templates/default/images/loading.gif";
//换肤
cookie_skin = $.cookie("MyCssSkin");
if (cookie_skin) {
	$('#cssfile2').attr("href","http://localhost:8090/shopnc/admin/templates/default/css/"+ cookie_skin +".css");
}
</script>
</head>
<body>
<div id="append_parent"></div>
<div id="ajaxwaitid"></div>
<link href="http://localhost:8090/shopnc/admin/templates/default/css/font/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
<!--[if IE 7]>
  <link rel="stylesheet" href="http://localhost:8090/shopnc/admin/templates/default/css/font/font-awesome/css/font-awesome-ie7.min.css">
<![endif]-->

<div class="page">
  <div class="fixed-bar">
    <div class="item-title">
      <h3>配送地区</h3>
      <ul class="tab-base">
        <li><a class="current"><span>配送地区</span></a></li>
      </ul>
    </div>
  </div>
  <div class="fixed-empty"></div>
  <form id="area_form" method="post">
    <input type="hidden" name="form_submit" value="ok" />
    <input type="hidden" name="act" value="offpay_area" />
    <input type="hidden" name="op" value="add" />
    <input type="hidden" name="county" id="county" value="" />
    <table class="table tb-type2" id="prompt">
      <tbody>
        <tr class="space odd">
          <th colspan="12"><div class="title">
              <h5>操作提示</h5>
              <span class="arrow"></span></div></th>
        </tr>
        <tr>
          <td><ul>
              <li>此处只能设置平台自营店铺支持货到付款的地区，注意：只有开启货到付款时以下设置的地区才会生效</li>
              <li>选择完子地区确认后，系统并未保存，需要点击页面底部的保存按钮系统才会保存设置的地区</li>
            </ul></td>
        </tr>
      </tbody>
    </table>
    <table id="table_area_box" class="table tb-type2">
      <thead>
        <tr class="thead">
          <th class="w10"></th>
          <th class="w120">省</th>
          <th>市</th>
        </tr>
      </thead>
      <tbody>
                <tr>
          <td></td>
          <td><label>
              <input type="checkbox"  value="1" name="province[]"/>
              <strong>北京</strong></label></td>
          <td>                        <div class="area-list">
              <label>
                <input  type="checkbox" nc_province="1" value="36" name="city[]"/>
                北京市 </label>
              (<span city_id="36" title="已选下级地区">0</span>)<a city_id="36" nc_title="北京市" province_id="1" nc_type="edit" href="javascript:void(0);" title="选择下级地区"><i class="icon-pencil"></i></a> </div>
            </td>
        </tr>
                        <tr>
          <td></td>
          <td><label>
              <input type="checkbox"  value="2" name="province[]"/>
              <strong>天津</strong></label></td>
          <td>                        <div class="area-list">
              <label>
                <input  type="checkbox" nc_province="2" value="40" name="city[]"/>
                天津市 </label>
              (<span city_id="40" title="已选下级地区">0</span>)<a city_id="40" nc_title="天津市" province_id="2" nc_type="edit" href="javascript:void(0);" title="选择下级地区"><i class="icon-pencil"></i></a> </div>
            </td>
        </tr>
                        <tr>
          <td></td>
          <td><label>
              <input type="checkbox"  value="3" name="province[]"/>
              <strong>河北</strong></label></td>
          <td>                        <div class="area-list">
              <label>
                <input  type="checkbox" nc_province="3" value="73" name="city[]"/>
                石家庄市 </label>
              (<span city_id="73" title="已选下级地区">0</span>)<a city_id="73" nc_title="石家庄市" province_id="3" nc_type="edit" href="javascript:void(0);" title="选择下级地区"><i class="icon-pencil"></i></a> </div>
                        <div class="area-list">
              <label>
                <input  type="checkbox" nc_province="3" value="74" name="city[]"/>
                唐山市 </label>
              (<span city_id="74" title="已选下级地区">0</span>)<a city_id="74" nc_title="唐山市" province_id="3" nc_type="edit" href="javascript:void(0);" title="选择下级地区"><i class="icon-pencil"></i></a> </div>
                        <div class="area-list">
              <label>
                <input  type="checkbox" nc_province="3" value="75" name="city[]"/>
                秦皇岛市 </label>
              (<span city_id="75" title="已选下级地区">0</span>)<a city_id="75" nc_title="秦皇岛市" province_id="3" nc_type="edit" href="javascript:void(0);" title="选择下级地区"><i class="icon-pencil"></i></a> </div>
                        <div class="area-list">
              <label>
                <input  type="checkbox" nc_province="3" value="76" name="city[]"/>
                邯郸市 </label>
              (<span city_id="76" title="已选下级地区">0</span>)<a city_id="76" nc_title="邯郸市" province_id="3" nc_type="edit" href="javascript:void(0);" title="选择下级地区"><i class="icon-pencil"></i></a> </div>
                        <div class="area-list">
              <label>
                <input  type="checkbox" nc_province="3" value="77" name="city[]"/>
                邢台市 </label>
              (<span city_id="77" title="已选下级地区">0</span>)<a city_id="77" nc_title="邢台市" province_id="3" nc_type="edit" href="javascript:void(0);" title="选择下级地区"><i class="icon-pencil"></i></a> </div>
                        <div class="area-list">
              <label>
                <input  type="checkbox" nc_province="3" value="78" name="city[]"/>
                保定市 </label>
              (<span city_id="78" title="已选下级地区">0</span>)<a city_id="78" nc_title="保定市" province_id="3" nc_type="edit" href="javascript:void(0);" title="选择下级地区"><i class="icon-pencil"></i></a> </div>
                        <div class="area-list">
              <label>
                <input  type="checkbox" nc_province="3" value="79" name="city[]"/>
                张家口市 </label>
              (<span city_id="79" title="已选下级地区">0</span>)<a city_id="79" nc_title="张家口市" province_id="3" nc_type="edit" href="javascript:void(0);" title="选择下级地区"><i class="icon-pencil"></i></a> </div>
                        <div class="area-list">
              <label>
                <input  type="checkbox" nc_province="3" value="80" name="city[]"/>
                承德市 </label>
              (<span city_id="80" title="已选下级地区">0</span>)<a city_id="80" nc_title="承德市" province_id="3" nc_type="edit" href="javascript:void(0);" title="选择下级地区"><i class="icon-pencil"></i></a> </div>
                        <div class="area-list">
              <label>
                <input  type="checkbox" nc_province="3" value="81" name="city[]"/>
                衡水市 </label>
              (<span city_id="81" title="已选下级地区">0</span>)<a city_id="81" nc_title="衡水市" province_id="3" nc_type="edit" href="javascript:void(0);" title="选择下级地区"><i class="icon-pencil"></i></a> </div>
                        <div class="area-list">
              <label>
                <input  type="checkbox" nc_province="3" value="82" name="city[]"/>
                廊坊市 </label>
              (<span city_id="82" title="已选下级地区">0</span>)<a city_id="82" nc_title="廊坊市" province_id="3" nc_type="edit" href="javascript:void(0);" title="选择下级地区"><i class="icon-pencil"></i></a> </div>
                        <div class="area-list">
              <label>
                <input  type="checkbox" nc_province="3" value="83" name="city[]"/>
                沧州市 </label>
              (<span city_id="83" title="已选下级地区">0</span>)<a city_id="83" nc_title="沧州市" province_id="3" nc_type="edit" href="javascript:void(0);" title="选择下级地区"><i class="icon-pencil"></i></a> </div>
            </td>
        </tr>
                      </tbody>
      <tfoot>
        <tr class="tfoot">
          <td colspan="15"><a href="JavaScript:void(0);" class="btn" id="submitBtn"><span>提交</span></a></td>
        </tr>
      </tfoot>
    </table>
  </form>
</div>
<script type="text/javascript" src="http://localhost:8090/shopnc/data/resource/js/area_array.js" charset="utf-8"></script> 
<script type="text/javascript" src="http://localhost:8090/shopnc/data/resource/js/dialog/dialog.js" id="dialog_js" charset="utf-8"></script> 
<script type="text/javascript" src="http://localhost:8090/shopnc/data/resource/js/jquery-ui/jquery.ui.js"></script> 
<script type="text/javascript">

//将系统已选择的县ID放入JS数组
var CUR_COUNTY = new Array();
CUR_COUNTY[438] = new Array();
CUR_COUNTY[438][4666] = true;
CUR_COUNTY[438][4667] = true;
CUR_COUNTY[438][4668] = true;
CUR_COUNTY[438][4669] = true;
CUR_COUNTY[438][4670] = true;
CUR_COUNTY[438][4671] = true;
CUR_COUNTY[438][4672] = true;
CUR_COUNTY[438][4673] = true;
CUR_COUNTY[438][4674] = true;
CUR_COUNTY[438][4675] = true;
CUR_COUNTY[438][4676] = true;
CUR_COUNTY[438][4677] = true;
CUR_COUNTY[438][4678] = true;
CUR_COUNTY[439] = new Array();
CUR_COUNTY[439][4679] = true;
CUR_COUNTY[439][4680] = true;
CUR_COUNTY[439][4681] = true;
CUR_COUNTY[439][4682] = true;
CUR_COUNTY[440] = new Array();
CUR_COUNTY[440][4683] = true;
CUR_COUNTY[440][4684] = true;
CUR_COUNTY[440][4685] = true;
CUR_COUNTY[440][4686] = true;
CUR_COUNTY[440][4687] = true;
CUR_COUNTY[440][4688] = true;
CUR_COUNTY[440][4689] = true;
CUR_COUNTY[440][4690] = true;
CUR_COUNTY[440][4691] = true;
CUR_COUNTY[440][4692] = true;
CUR_COUNTY[440][4693] = true;
CUR_COUNTY[440][4694] = true;
CUR_COUNTY[441] = new Array();
CUR_COUNTY[441][4695] = true;
CUR_COUNTY[441][4696] = true;
CUR_COUNTY[441][4697] = true;
CUR_COUNTY[441][4698] = true;
CUR_COUNTY[441][4699] = true;
CUR_COUNTY[441][4700] = true;
CUR_COUNTY[441][4701] = true;
CUR_COUNTY[441][4702] = true;
CUR_COUNTY[441][4703] = true;
CUR_COUNTY[441][4704] = true;
CUR_COUNTY[441][4705] = true;
CUR_COUNTY[441][4706] = true;
CUR_COUNTY[441][4707] = true;
CUR_COUNTY[441][4708] = true;
CUR_COUNTY[442] = new Array();
CUR_COUNTY[442][4709] = true;
CUR_COUNTY[442][4710] = true;
CUR_COUNTY[442][4711] = true;
CUR_COUNTY[442][4712] = true;
CUR_COUNTY[442][4713] = true;
CUR_COUNTY[442][4714] = true;
CUR_COUNTY[442][4715] = true;
CUR_COUNTY[442][4716] = true;
CUR_COUNTY[442][4717] = true;
CUR_COUNTY[442][4718] = true;
CUR_COUNTY[442][4719] = true;
CUR_COUNTY[443] = new Array();
CUR_COUNTY[443][4720] = true;
CUR_COUNTY[443][4721] = true;
CUR_COUNTY[443][4722] = true;
CUR_COUNTY[443][4723] = true;
CUR_COUNTY[443][4724] = true;
CUR_COUNTY[443][4725] = true;
CUR_COUNTY[443][4726] = true;
CUR_COUNTY[443][4727] = true;
CUR_COUNTY[443][4728] = true;
CUR_COUNTY[443][4729] = true;
CUR_COUNTY[443][4730] = true;
CUR_COUNTY[443][4731] = true;
CUR_COUNTY[443][4732] = true;
CUR_COUNTY[444] = new Array();
CUR_COUNTY[444][4733] = true;
CUR_COUNTY[444][4734] = true;
CUR_COUNTY[444][4735] = true;
CUR_COUNTY[444][4736] = true;
CUR_COUNTY[444][4737] = true;
CUR_COUNTY[444][4738] = true;
CUR_COUNTY[444][4739] = true;
CUR_COUNTY[444][4740] = true;
CUR_COUNTY[444][4741] = true;
CUR_COUNTY[444][4742] = true;
CUR_COUNTY[444][4743] = true;
CUR_COUNTY[445] = new Array();
CUR_COUNTY[445][4744] = true;
CUR_COUNTY[445][4745] = true;
CUR_COUNTY[445][4746] = true;
CUR_COUNTY[445][4747] = true;
CUR_COUNTY[445][4748] = true;
CUR_COUNTY[445][4749] = true;
CUR_COUNTY[445][4750] = true;
CUR_COUNTY[445][4751] = true;
CUR_COUNTY[445][4752] = true;
CUR_COUNTY[445][4753] = true;
CUR_COUNTY[445][4754] = true;
CUR_COUNTY[445][4755] = true;
CUR_COUNTY[446] = new Array();
CUR_COUNTY[446][4756] = true;
CUR_COUNTY[446][4757] = true;
CUR_COUNTY[446][4758] = true;
CUR_COUNTY[446][4759] = true;
CUR_COUNTY[446][4760] = true;
CUR_COUNTY[446][4761] = true;
CUR_COUNTY[446][4762] = true;
CUR_COUNTY[446][4763] = true;
CUR_COUNTY[446][4764] = true;
CUR_COUNTY[446][4765] = true;
CUR_COUNTY[447] = new Array();
CUR_COUNTY[447][4766] = true;
CUR_COUNTY[447][4767] = true;
CUR_COUNTY[447][4768] = true;
CUR_COUNTY[447][4769] = true;
CUR_COUNTY[447][4770] = true;
CUR_COUNTY[447][4771] = true;
CUR_COUNTY[447][4772] = true;

$(function(){

	//省点击事件
    $('input[name="province[]"]').on('click',function(){
        if ($(this).attr('checked') == 'checked'){
        	$('input[nc_province="' + $(this).val() + '"]').each(function(){
            	$(this).attr('checked','checked');
                if (typeof nc_a[$(this).val()] == 'object') {
                    county_array = nc_a[$(this).val()];
                } else {
                    county_array = new Array();
                }
                CUR_COUNTY[$(this).val()] = new Array();
               
        		count = county_array.length;
        		$('span[city_id="'+$(this).val()+'"]').html(count);
        	});
        }else{
        	$('input[nc_province="' + $(this).val() + '"]').each(function(){
            	$(this).attr('checked',false);
        		CUR_COUNTY[$(this).val()] = undefined;
        		$('span[city_id="'+$(this).val()+'"]').html(0);
        	});
        }
    });

    //点击编辑事件
    $('a[nc_type="edit"]').on('click',function(){
            if (typeof CUR_COUNTY[$(this).attr('city_id')] == 'object'){
                cur_county = CUR_COUNTY[$(this).attr('city_id')];
            }else{
                cur_county = new Array();
            }
        	var province_array = nc_a[$(this).attr('city_id')];
            if (typeof nc_a[$(this).attr('city_id')] == 'object'){
                county_array = nc_a[$(this).attr('city_id')];
            }else{
                county_array = new Array();
            }
            if (county_array.length == 0) {
                alert('下面没有子地区，无需要编辑');
                return;
            }
            county_html = '<table id="table_area_box_edit" class="table tb-type2"><tbody><tr class="noborder"><td city_id="'+$(this).attr('city_id')+'" province_id="'+$(this).attr('province_id')+'">';
            
            county_html += '</td></tr><tr><td class="align-center"><a id="county_submit" class="btn" href="JavaScript:void(0);"><span>确认</span></a></td></tr><tr class="noborder"><td class="align-center" style="color:#f30;">确认后，还需要点击页面底部的保存按钮完成保存操作</td></tr></tbody></table>';
            html_form('select_county', '选择 '+ $(this).attr('nc_title') +' 子地区', county_html, 500,1);
    });

    //选择市级事件
	$('input[name="city[]"]').on('click',function(){
		if ($(this).attr('checked')) {
            if (typeof nc_a[$(this).val()] == 'object') {
                county_array = nc_a[$(this).val()];
            } else {
                county_array = new Array();
            }
            CUR_COUNTY[$(this).val()] = new Array();
           
			count = county_array.length;
			if ($('input[nc_province="'+$(this).attr('nc_province')+'"]').size() == $('input[nc_province="'+$(this).attr('nc_province')+'"]:checked').size()) {
				$('input[value="'+$(this).attr('nc_province')+'"]').attr('checked',true);
			} else {
				$('input[value="'+$(this).attr('nc_province')+'"]').attr('checked',false);
			}
		} else {
			CUR_COUNTY[$(this).val()] = undefined;
			count = 0;
			$('input[value="'+$(this).attr('nc_province')+'"]').attr('checked',false);
		}
		$('span[city_id="'+$(this).val()+'"]').html(count);
	});

	//弹出县编辑确认事件
    $('body').on('click','#county_submit',function(){
        cur_td = $('.dialog_content > table > tbody > tr > td');
        cur_checkbox = cur_td.find('input[type="checkbox"]');
        cur_checkbox.each(function(){
            if ($(this).attr('checked')) {
            	if (typeof CUR_COUNTY[cur_td.attr('city_id')] != 'object') {
            		CUR_COUNTY[cur_td.attr('city_id')] = new Array();
            	}
            	CUR_COUNTY[cur_td.attr('city_id')][$(this).val()] = true;
            } else {
                if (typeof CUR_COUNTY[cur_td.attr('city_id')] == 'object') {
                	if (typeof CUR_COUNTY[cur_td.attr('city_id')][$(this).val()] != 'undefined') {
              		   CUR_COUNTY[cur_td.attr('city_id')][$(this).val()] = undefined;
                	}
                }
            }
        });
        cur_new_county = cur_td.find('input[type="checkbox"]:checked').size();
        $('span[city_id="'+cur_td.attr('city_id')+'"]').html(cur_new_county);
        if (cur_checkbox.size() == cur_new_county) {
            v = true;
        } else {
            v = false;
        }
        $('input[value="'+cur_td.attr('city_id')+'"]').attr('checked',v);

		if ($('input[nc_province="'+cur_td.attr('province_id')+'"]').size() == $('input[nc_province="'+cur_td.attr('province_id')+'"]:checked').size()) {
			$('input[value="'+cur_td.attr('province_id')+'"]').attr('checked',true);
		} else {
			$('input[value="'+cur_td.attr('province_id')+'"]').attr('checked',false);
		}
        
        DialogManager.close('select_county');
    });

    //表单提交事件
	$("#submitBtn").click(function(){
		var county_id_str = '';
		for(var city_id in CUR_COUNTY) {
			for(var county_d in CUR_COUNTY[city_id]) {
				if (typeof(CUR_COUNTY[city_id][county_d]) != 'undefined') {
					county_id_str += county_d + ',';
				}
			}
		}
		$("#county").val(county_id_str);
        $("#area_form").submit();
	});
});
</script></body>
</html>
